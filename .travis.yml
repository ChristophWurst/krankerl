language: rust
rust:
  - stable
  - beta
  - nightly

branches:
  only:
  - staging
  - trying
  - master
  - "/^stable\\d+(\\.\\d+)?$/"
  - "/^v\\d++(\\.\\d+)?+(\\.\\d+)?+(\\.\\d+)?$/"

cache: cargo

before_deploy:
  - cargo install -f cargo-deb
  - cargo build --release
  - cargo deb

deploy:
  - provider: releases
    api_key: $GITHUB_TOKEN
    file:  target/release/krankerl
    skip_cleanup: true
    on:
      tags: true
      condition: $TRAVIS_RUST_VERSION == stable
  - provider: releases
    api_key: $GITHUB_TOKEN
    file: target/debian/krankerl_$TRAVIS_TAG_amd64.deb
    skip_cleanup: true
    on:
      tags: true
      condition: $TRAVIS_RUST_VERSION == stable
